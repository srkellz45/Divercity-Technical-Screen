{"ast":null,"code":"import _classCallCheck from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/src/containers/NewMessages/index.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { getUser as _getUser, getOtherUser as _getOtherUser } from '../../actions/user.actions';\nimport { sendNewMessage as _sendNewMessage, loadChat as _loadChat, createChatID as _createChatID, getAllChats as _getAllChats } from '../../actions/chat.actions';\nimport { url } from '../../lib/url';\nimport Chats from '../../components/message.chats.components.js';\nimport Message from '../../components/message.message.components.js';\nimport NewMessage from '../../components/message.new.components.js';\nimport ChatBox from '../Messages/ChatBox';\nimport NewMessageChatBox from './NewMessageChatBox';\nimport Header from '../../components/Header.js'; // let wssURL = 'wss://api.divercity.io/cable';\n\nvar ID = parseInt(localStorage.getItem('id')); // let socketURL = `${wssURL}/?token=${localStorage.getItem('access-token')}&client=${localStorage.getItem('client')}&uid=${localStorage.getItem('uid')}`;\n// let ws = new WebSocket(socketURL);\n\nvar NewMessages =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(NewMessages, _Component);\n\n  function NewMessages(props) {\n    var _this;\n\n    _classCallCheck(this, NewMessages);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(NewMessages).call(this, props));\n    _this.state = {\n      chatHistory: [],\n      searchValue: '',\n      chatInput: '',\n      chatID: localStorage.chatID,\n      otherID: '',\n      selected: true\n    };\n    _this.addMessage = _this.addMessage.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleLoadChat = _this.handleLoadChat.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleSearchInput = _this.handleSearchInput.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleChatInput = _this.handleChatInput.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(NewMessages, [{\n    key: \"addMessage\",\n    value: function addMessage(message) {\n      // Append the message to the component state\n      var messageAdd = this.state.chatHistory;\n      messageAdd.push(message);\n      this.setState({\n        chatHistory: messageAdd\n      }); //ws.send(JSON.stringify(messages));\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.props.getUser(ID);\n      this.props.getOtherUser(this.props.match.params.id);\n      this.props.getAllChats(ID);\n      this.props.createChatID(ID, this.props.match.params.id);\n    } // componentDidUpdate(prevProps, prevState) {\n    //   // This loads the most recent messages upon receiving allMessages PROPS\n    //   if (prevProps.allMessages !== this.props.allMessages) {\n    //     if(!this.state.chatID.length){\n    //       this.setState({\n    //         chatID: this.props.allMessages[0].chat_id,\n    //         otherID: this.props.allMessages[0].id,\n    //       });\n    //     this.props.loadChat(ID, this.props.allMessages[0].chat_id, this.props.allMessages[0].id);\n    //   }\n    // }\n    // }\n    // sendHandler(evt) {\n    //   evt.preventDefault();\n    //   const messageObject = {\n    //     from_username: 'Ricky Peters',\n    //     message: this.state.chatInput,\n    //     from_user_avatar_thumb: localStorage.image\n    //   };\n    //   // Emit the message to the server\n    //   this.props.sendNewMessage(messageObject.message, this.state.chatID);\n    //   messageObject.fromMe = true;\n    //   this.addMessage(messageObject);\n    //   this.setState({\n    //     chatInput: ''\n    //   });\n    // }\n\n  }, {\n    key: \"handleLoadChat\",\n    value: function handleLoadChat(evt) {\n      evt.preventDefault();\n      this.setState({\n        chatID: parseInt(evt.currentTarget.id.split(', ')[1]),\n        otherID: parseInt(evt.currentTarget.id.split(', ')[0]),\n        chatHistory: [],\n        selected: false\n      });\n      var myID = parseInt(localStorage.id);\n      var chatID = parseInt(evt.currentTarget.id.split(', ')[1]);\n      var otherID = parseInt(evt.currentTarget.id.split(', ')[0]);\n      this.props.loadChat(myID, chatID, otherID);\n    }\n  }, {\n    key: \"handleSearchInput\",\n    value: function handleSearchInput(evt) {\n      this.setState({\n        searchValue: evt.target.value\n      });\n    }\n  }, {\n    key: \"handleChatInput\",\n    value: function handleChatInput(evt) {\n      this.setState({\n        chatInput: evt.target.value\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      console.log(this.props.otherUser);\n      console.log(localStorage.chatID);\n      return React.createElement(\"div\", {\n        id: \"main\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      }, React.createElement(Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"Messages-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"Messages-container-left\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"Messages-search-input\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }, React.createElement(\"form\", {\n        id: \"messages-search\",\n        onSubmit: this.handleSearch,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        value: this.state.searchValue,\n        placeholder: \"Search\",\n        id: \"message-search-form\",\n        type: \"text\",\n        onChange: this.handleSearchInput,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }))), this.props.allMessages ? React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, this.props.otherUser.length && this.state.selected ? React.createElement(\"div\", {\n        className: \"Selected-Chats\",\n        onClick: this.handleLoadChat,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 128\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"colorOverlay\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 129\n        },\n        __self: this\n      }, React.createElement(NewMessage, {\n        data: this.props.otherUser[0],\n        id: this.props.otherUser[0].id,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }))) : null, this.props.allMessages.map(function (messages) {\n        return React.createElement(React.Fragment, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 140\n          },\n          __self: this\n        }, localStorage.chatID === messages.chat_id ? React.createElement(\"div\", {\n          className: \"Selected-Chats\",\n          onClick: _this2.handleLoadChat,\n          id: \"\".concat(messages.id, \", \").concat(messages.chat_id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"colorOverlay\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, React.createElement(Chats, {\n          data: messages,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }))) : React.createElement(\"div\", {\n          className: \"Chats\",\n          onClick: _this2.handleLoadChat,\n          id: \"\".concat(messages.id, \", \").concat(messages.chat_id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150\n          },\n          __self: this\n        }, React.createElement(Chats, {\n          data: messages,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 151\n          },\n          __self: this\n        })));\n      })) : React.createElement(\"div\", {\n        className: \"Loading-Chats\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }, \"loading chat history\")), React.createElement(\"div\", {\n        className: \"Chatbox-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 167\n        },\n        __self: this\n      }, this.props.allMessages.length ? React.createElement(React.Fragment, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169\n        },\n        __self: this\n      }, this.props.allMessages.map(function (messages) {\n        return React.createElement(React.Fragment, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172\n          },\n          __self: this\n        }, localStorage.chatID === messages.chat_id ? React.createElement(\"div\", {\n          id: \"chat-header\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 174\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"Chat-image\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 175\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          src: messages.avatar_thumb,\n          alt: \"chat\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 176\n          },\n          __self: this\n        })), React.createElement(\"div\", {\n          id: \"Chat-Name\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 178\n          },\n          __self: this\n        }, messages.name)) : null);\n      })) : null), React.createElement(\"div\", {\n        className: \"Messages-container-right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, this.props.otherUser.length && this.state.selected ? React.createElement(NewMessageChatBox, {\n        chatID: localStorage.chatID,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }) : null)));\n    }\n  }]);\n\n  return NewMessages;\n}(Component);\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.userList,\n    chatID: state.chatID,\n    messages: state.chatList,\n    allMessages: state.allChatsList,\n    otherUser: state.otherUserList\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    getUser: function getUser(ID) {\n      dispatch(_getUser(ID));\n    },\n    sendNewMessage: function sendNewMessage(message, id) {\n      dispatch(_sendNewMessage(message, id));\n    },\n    loadChat: function loadChat(myID, chatID, otherID) {\n      dispatch(_loadChat(myID, chatID, otherID));\n    },\n    createChatID: function createChatID(myID, otherID) {\n      dispatch(_createChatID(myID, otherID));\n    },\n    getAllChats: function getAllChats(id) {\n      dispatch(_getAllChats(id));\n    },\n    getOtherUser: function getOtherUser(id) {\n      dispatch(_getOtherUser(id));\n    }\n  };\n};\n\nexport default connect(mapStateToProps, mapDispatchToProps)(NewMessages); // <div>\n// { this.state.chatHistory.length ? (\n//     <React.Fragment>\n//         { this.state.chatHistory.map((chats) => {\n//           return (\n//             <div>\n//               <Message messages={chats} />\n//           </div>\n//           )\n//         })}\n//     </React.Fragment>\n//   ) : null }\n// </div>\n// </div>","map":{"version":3,"sources":["/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/src/containers/NewMessages/index.js"],"names":["React","Component","connect","getUser","getOtherUser","sendNewMessage","loadChat","createChatID","getAllChats","url","Chats","Message","NewMessage","ChatBox","NewMessageChatBox","Header","ID","parseInt","localStorage","getItem","NewMessages","props","state","chatHistory","searchValue","chatInput","chatID","otherID","selected","addMessage","bind","handleLoadChat","handleSearchInput","handleChatInput","message","messageAdd","push","setState","match","params","id","evt","preventDefault","currentTarget","split","myID","target","value","console","log","otherUser","handleSearch","allMessages","length","map","messages","chat_id","avatar_thumb","name","mapStateToProps","user","userList","chatList","allChatsList","otherUserList","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { getUser, getOtherUser } from '../../actions/user.actions';\nimport { sendNewMessage, loadChat, createChatID, getAllChats } from '../../actions/chat.actions';\nimport { url } from '../../lib/url';\nimport Chats from '../../components/message.chats.components.js';\nimport Message from '../../components/message.message.components.js';\nimport NewMessage from '../../components/message.new.components.js';\nimport ChatBox from '../Messages/ChatBox';\nimport NewMessageChatBox from './NewMessageChatBox';\nimport Header from '../../components/Header.js';\n\n// let wssURL = 'wss://api.divercity.io/cable';\n let ID = parseInt(localStorage.getItem('id'));\n// let socketURL = `${wssURL}/?token=${localStorage.getItem('access-token')}&client=${localStorage.getItem('client')}&uid=${localStorage.getItem('uid')}`;\n// let ws = new WebSocket(socketURL);\n\nclass NewMessages extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      chatHistory: [],\n      searchValue: '',\n      chatInput: '',\n      chatID: localStorage.chatID,\n      otherID: '',\n      selected: true,\n    };\n    this.addMessage = this.addMessage.bind(this);\n    this.handleLoadChat = this.handleLoadChat.bind(this);\n    this.handleSearchInput = this.handleSearchInput.bind(this);\n    this.handleChatInput = this.handleChatInput.bind(this);\n  }\n  addMessage(message) {\n    // Append the message to the component state\n    let messageAdd = this.state.chatHistory;\n    messageAdd.push(message);\n    this.setState({\n      chatHistory: messageAdd\n    });\n    //ws.send(JSON.stringify(messages));\n  }\n  componentDidMount() {\n    this.props.getUser(ID);\n    this.props.getOtherUser(this.props.match.params.id);\n    this.props.getAllChats(ID);\n    this.props.createChatID(ID, this.props.match.params.id);\n  }\n  // componentDidUpdate(prevProps, prevState) {\n  //   // This loads the most recent messages upon receiving allMessages PROPS\n  //   if (prevProps.allMessages !== this.props.allMessages) {\n  //     if(!this.state.chatID.length){\n  //       this.setState({\n  //         chatID: this.props.allMessages[0].chat_id,\n  //         otherID: this.props.allMessages[0].id,\n  //       });\n  //     this.props.loadChat(ID, this.props.allMessages[0].chat_id, this.props.allMessages[0].id);\n  //   }\n  // }\n  // }\n\n\n  // sendHandler(evt) {\n  //   evt.preventDefault();\n  //   const messageObject = {\n  //     from_username: 'Ricky Peters',\n  //     message: this.state.chatInput,\n  //     from_user_avatar_thumb: localStorage.image\n  //   };\n  //   // Emit the message to the server\n  //   this.props.sendNewMessage(messageObject.message, this.state.chatID);\n\n  //   messageObject.fromMe = true;\n\n  //   this.addMessage(messageObject);\n  //   this.setState({\n  //     chatInput: ''\n  //   });\n  // }\n  handleLoadChat(evt) {\n    evt.preventDefault();\n    this.setState({\n      chatID: parseInt(evt.currentTarget.id.split(', ')[1]),\n      otherID: parseInt(evt.currentTarget.id.split(', ')[0]),\n      chatHistory: [],\n      selected: false,\n    });\n    let myID = parseInt(localStorage.id);\n    let chatID = parseInt(evt.currentTarget.id.split(', ')[1]);\n    let otherID = parseInt(evt.currentTarget.id.split(', ')[0]);\n    this.props.loadChat(myID, chatID, otherID);\n  }\n\n  handleSearchInput(evt) {\n    this.setState({\n      searchValue: evt.target.value\n    });\n  }\n  handleChatInput(evt) {\n    this.setState({\n      chatInput: evt.target.value\n    });\n  }\n\n  render() {\n    console.log(this.props.otherUser);\n    console.log(localStorage.chatID);\n    return (\n      <div id=\"main\">\n        <Header />\n        <div className=\"Messages-container\">\n          <div className=\"Messages-container-left\">\n          <div id=\"Messages-search-input\">\n            <form id=\"messages-search\" onSubmit={this.handleSearch}>\n              <input\n                value={ this.state.searchValue }\n                placeholder=\"Search\"\n                id=\"message-search-form\"\n                type=\"text\"\n                onChange={ this.handleSearchInput } />\n            </form>\n          </div>\n\n            { this.props.allMessages ? (\n              <React.Fragment>\n\n                { this.props.otherUser.length && this.state.selected ? (\n                    <div className=\"Selected-Chats\" onClick={this.handleLoadChat}>\n                      <div className=\"colorOverlay\">\n                        <NewMessage\n                          data={ this.props.otherUser[0] }\n                          id={ this.props.otherUser[0].id }\n                        />\n                      </div>\n                    </div>\n                ) : ( null )}\n\n                { this.props.allMessages.map((messages) => {\n                  return (\n                  <React.Fragment>\n                  { localStorage.chatID === messages.chat_id ? (\n                    <div className=\"Selected-Chats\" onClick={this.handleLoadChat} id={`${messages.id}, ${messages.chat_id}`}>\n                      <div className=\"colorOverlay\">\n                      <Chats\n                        data={ messages }\n                      />\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"Chats\" onClick={this.handleLoadChat} id={`${messages.id}, ${messages.chat_id}`}>\n                      <Chats\n                        data={ messages }\n                      />\n                      </div>\n\n                  )}\n                  </React.Fragment>\n                )})\n              }\n              </React.Fragment>\n            ) : (\n              <div className=\"Loading-Chats\">\n                loading chat history\n              </div>\n            )}\n          </div>\n            <div className=\"Chatbox-header\">\n            { this.props.allMessages.length ? (\n              <React.Fragment>\n              { this.props.allMessages.map((messages) => {\n                return (\n                  <React.Fragment>\n                  { localStorage.chatID === messages.chat_id ? (\n                    <div id=\"chat-header\">\n                      <div className=\"Chat-image\">\n                        <img src={messages.avatar_thumb} alt=\"chat\" />\n                      </div>\n                      <div id=\"Chat-Name\">\n                        {messages.name}\n                      </div>\n                    </div>\n                  ) : null }\n                  </React.Fragment>\n                )})}\n              </React.Fragment>\n            ) : null }\n            </div>\n          <div className=\"Messages-container-right\">\n            { this.props.otherUser.length && this.state.selected ? (\n              <NewMessageChatBox\n                chatID={localStorage.chatID}\n              />\n            ) : ( null )}\n\n          </div>\n\n        </div>\n      </div>\n    );\n  }\n\n}\n\nconst mapStateToProps = (state) => {\n  return {\n    user : state.userList,\n    chatID : state.chatID,\n    messages : state.chatList,\n    allMessages : state.allChatsList,\n    otherUser: state.otherUserList,\n  }\n}\n\nconst mapDispatchToProps = (dispatch) => {\n  return {\n    getUser: (ID) => {\n      dispatch(getUser(ID))\n    },\n    sendNewMessage: (message, id) => {\n      dispatch(sendNewMessage(message, id));\n    },\n    loadChat: (myID, chatID, otherID) => {\n      dispatch(loadChat(myID, chatID, otherID));\n    },\n    createChatID: (myID, otherID) => {\n      dispatch(createChatID(myID, otherID))\n    },\n    getAllChats: (id) => {\n      dispatch(getAllChats(id))\n    },\n    getOtherUser: (id) => {\n      dispatch(getOtherUser(id));\n    },\n  }\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(NewMessages);\n\n\n\n           // <div>\n           // { this.state.chatHistory.length ? (\n           //     <React.Fragment>\n           //         { this.state.chatHistory.map((chats) => {\n           //           return (\n           //             <div>\n           //               <Message messages={chats} />\n           //           </div>\n           //           )\n           //         })}\n           //     </React.Fragment>\n           //   ) : null }\n           // </div>\n           // </div>"]},"metadata":{},"sourceType":"module"}