{"ast":null,"code":"import _classCallCheck from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/src/containers/Messages/index.js\";\nimport React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { getUser } from '../../actions/user.actions';\nimport { sendNewMessage, loadChat, createChatID, getAllChats } from '../../actions/chat.actions';\nimport { NavLink } from 'react-router-dom';\nimport { url } from '../../lib/url';\nimport Chats from '../../components/message.chats.components.js';\nimport Message from '../../components/message.message.components.js';\nimport ChatBox from './ChatBox';\nimport Header from '../../components/Header.js'; // let wssURL = 'wss://api.divercity.io/cable';\n// let socketURL = `${wssURL}/?token=${localStorage.getItem('access-token')}&client=${localStorage.getItem('client')}&uid=${localStorage.getItem('uid')}`;\n// let ws = new WebSocket(socketURL);\n\nvar DirectMessage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(DirectMessage, _Component);\n\n  function DirectMessage(props) {\n    var _this;\n\n    _classCallCheck(this, DirectMessage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DirectMessage).call(this, props));\n\n    _this.addMessage = function (message) {\n      // Append the message to the component state\n      var messageAdd = _this.state.chatHistory;\n      messageAdd.push(message);\n\n      _this.setState({\n        chatHistory: messageAdd\n      });\n    };\n\n    _this.sendHandler = function (evt) {\n      evt.preventDefault();\n      var messageObject = {\n        from_username: localStorage.username,\n        message: _this.state.chatInput,\n        from_user_avatar_thumb: localStorage.image\n      }; // Emit the message to the server\n\n      _this.props.sendNewMessage(messageObject.message, _this.state.chatID);\n\n      messageObject.fromMe = true;\n\n      _this.addMessage(messageObject);\n\n      _this.setState({\n        chatInput: ''\n      });\n    };\n\n    _this.handleLoadChat = function (evt) {\n      evt.preventDefault();\n\n      _this.setState({\n        chatID: parseInt(evt.currentTarget.id.split(', ')[1]),\n        otherID: parseInt(evt.currentTarget.id.split(', ')[0]),\n        chatHistory: []\n      });\n\n      var myID = parseInt(localStorage.id);\n      var chatID = parseInt(evt.currentTarget.id.split(', ')[1]);\n      var otherID = parseInt(evt.currentTarget.id.split(', ')[0]);\n\n      _this.props.loadChat(myID, chatID, otherID);\n    };\n\n    _this.handleChatInput = function (evt) {\n      return _this.setState({\n        chatInput: evt.target.value\n      });\n    };\n\n    _this.state = {\n      chatHistory: [],\n      searchValue: '',\n      chatInput: '',\n      chatID: '',\n      otherID: '',\n      ID: parseInt(localStorage.getItem('id'))\n    };\n    return _this;\n  }\n\n  _createClass(DirectMessage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var ID = this.state.ID;\n      this.props.getUser(ID);\n      this.props.getAllChats(ID); // ws.onopen = function(e) {\n      //   console.log(e, 'onopen ------');\n      //     // SUBSCRIBE\n      //     ws.send(subscribe_params);\n      // }.bind(this);\n      //this.props.createChatID(ID, this.props.match.params.id);\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      // This loads the most recent messages upon receiving allMessages PROPS\n      if (this.props.allMessages.length) {\n        if (prevProps.allMessages !== this.props.allMessages) {\n          if (!this.state.chatID.length) {\n            this.setState({\n              chatID: this.props.allMessages[0].chat_id,\n              otherID: this.props.allMessages[0].id\n            });\n            this.props.loadChat(this.state.ID, this.props.allMessages[0].chat_id, this.props.allMessages[0].id);\n          }\n        }\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        id: \"main\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 112\n        },\n        __self: this\n      }, React.createElement(Header, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"Messages-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 115\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"Messages-container-left\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 116\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        id: \"Messages-search-input\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 117\n        },\n        __self: this\n      }, React.createElement(\"form\", {\n        id: \"messages-search\",\n        onSubmit: this.handleSearch,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        value: this.state.searchValue,\n        placeholder: \"Search\",\n        id: \"message-search-form\",\n        type: \"text\",\n        onChange: function onChange(evt) {\n          return _this2.setState({\n            searchValue: evt.target.value\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119\n        },\n        __self: this\n      }))), this.props.allMessages ? this.props.allMessages.map(function (messages, i) {\n        return React.createElement(\"div\", {\n          key: i,\n          className: _this2.state.chatID === messages.chat_id ? \"Selected-Chats\" : \"Chats\",\n          id: \"\".concat(messages.id, \", \").concat(messages.chat_id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 131\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: _this2.state.chatID === messages.chat_id ? \"colorOverlay\" : null,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 132\n          },\n          __self: this\n        }, React.createElement(Chats, {\n          data: messages,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133\n          },\n          __self: this\n        })));\n      }) : React.createElement(\"div\", {\n        className: \"Loading-Chats\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }, \"loading chat history\")), React.createElement(\"div\", {\n        className: \"Chatbox-header\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }, this.props.allMessages.length ? this.props.allMessages.map(function (messages, i) {\n        return _this2.state.chatID === messages.chat_id ? React.createElement(\"div\", {\n          id: \"chat-header\",\n          key: i,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 142\n          },\n          __self: this\n        }, React.createElement(\"div\", {\n          className: \"Chat-image\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 143\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          href: \"/users/\".concat(messages.chat_users[messages.chat_users[1].id === _this2.state.ID ? 0 : 1].id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 144\n          },\n          __self: this\n        }, React.createElement(\"img\", {\n          src: messages.avatar_thumb,\n          alt: \"chat\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 145\n          },\n          __self: this\n        }))), React.createElement(\"div\", {\n          id: \"Chat-Name\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 149\n          },\n          __self: this\n        }, React.createElement(\"a\", {\n          href: \"/users/\".concat(messages.chat_users[messages.chat_users[1].id === _this2.state.ID ? 0 : 1].id),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 150\n          },\n          __self: this\n        }, messages.name))) : null;\n      }) : React.createElement(\"div\", {\n        className: \"No-Messages\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"Messages-container-right\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160\n        },\n        __self: this\n      }, this.props.messages.length ? React.createElement(ChatBox, {\n        canon: this.props.messages[0].chat_id,\n        chatID: this.state.chatID,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162\n        },\n        __self: this\n      }) : React.createElement(\"div\", {\n        className: \"No-Messages\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166\n        },\n        __self: this\n      }, \" No messages yet \"))));\n    }\n  }]);\n\n  return DirectMessage;\n}(Component);\n\nDirectMessage.defaultProps = {\n  username: localStorage.name\n};\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    user: state.userList,\n    chatID: state.chatID,\n    messages: state.chatList,\n    allMessages: state.allChatsList\n  };\n};\n\nexport default connect(mapStateToProps, {\n  getUser: getUser,\n  sendNewMessage: sendNewMessage,\n  loadChat: loadChat,\n  createChatID: createChatID,\n  getAllChats: getAllChats\n})(DirectMessage);","map":{"version":3,"sources":["/Users/seanromero/Documents/web-projects/personal-projects/divercity-coding-challenge/divercity/src/containers/Messages/index.js"],"names":["React","Component","connect","getUser","sendNewMessage","loadChat","createChatID","getAllChats","NavLink","url","Chats","Message","ChatBox","Header","DirectMessage","props","addMessage","message","messageAdd","state","chatHistory","push","setState","sendHandler","evt","preventDefault","messageObject","from_username","localStorage","username","chatInput","from_user_avatar_thumb","image","chatID","fromMe","handleLoadChat","parseInt","currentTarget","id","split","otherID","myID","handleChatInput","target","value","searchValue","ID","getItem","prevProps","prevState","allMessages","length","chat_id","handleSearch","map","messages","i","chat_users","avatar_thumb","name","defaultProps","mapStateToProps","user","userList","chatList","allChatsList"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { getUser } from '../../actions/user.actions';\nimport { sendNewMessage, loadChat, createChatID, getAllChats } from '../../actions/chat.actions';\nimport { NavLink } from 'react-router-dom';\nimport { url } from '../../lib/url';\nimport Chats from '../../components/message.chats.components.js';\nimport Message from '../../components/message.message.components.js';\nimport ChatBox from './ChatBox';\nimport Header from '../../components/Header.js';\n\n// let wssURL = 'wss://api.divercity.io/cable';\n// let socketURL = `${wssURL}/?token=${localStorage.getItem('access-token')}&client=${localStorage.getItem('client')}&uid=${localStorage.getItem('uid')}`;\n// let ws = new WebSocket(socketURL);\n\nclass DirectMessage extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tchatHistory: [],\n\t\t\tsearchValue: '',\n\t\t\tchatInput: '',\n\t\t\tchatID: '',\n\t\t\totherID: '',\n\t\t\tID: parseInt(localStorage.getItem('id'))\n\t\t}\n\t}\n\n\taddMessage = message => {\n\t\t// Append the message to the component state\n\t\tlet messageAdd = this.state.chatHistory;\n\n\t\tmessageAdd.push(message);\n\n\t\tthis.setState({\n\t\t\tchatHistory: messageAdd\n\t\t});\n\t}\n\n  componentDidMount() {\n  \tvar {ID} = this.state;\n\n    this.props.getUser(ID);\n    this.props.getAllChats(ID);\n    // ws.onopen = function(e) {\n    //   console.log(e, 'onopen ------');\n    //     // SUBSCRIBE\n    //     ws.send(subscribe_params);\n    // }.bind(this);\n    //this.props.createChatID(ID, this.props.match.params.id);\n  }\n\n\tcomponentDidUpdate(prevProps, prevState) {\n\t\t// This loads the most recent messages upon receiving allMessages PROPS\n    \tif( this.props.allMessages.length ) {\n      \t\tif (prevProps.allMessages !== this.props.allMessages) {\n        \t\tif(!this.state.chatID.length){\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\tchatID: this.props.allMessages[0].chat_id,\n\t\t\t\t\t\totherID: this.props.allMessages[0].id\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.props.loadChat(this.state.ID, this.props.allMessages[0].chat_id, this.props.allMessages[0].id);\n\t\t\t\t}\n    \t\t}\n\t\t}\n\t}\n\n\tsendHandler = evt => {\n\t\tevt.preventDefault();\n\n\t\tconst messageObject = {\n\t\t\tfrom_username: localStorage.username,\n\t\t\tmessage: this.state.chatInput,\n\t\t\tfrom_user_avatar_thumb: localStorage.image\n\t\t};\n\n\t\t// Emit the message to the server\n\t\tthis.props.sendNewMessage(messageObject.message, this.state.chatID);\n\n\t\tmessageObject.fromMe = true;\n\n\t\tthis.addMessage(messageObject);\n\n\t\tthis.setState({\n\t\t\tchatInput: ''\n\t\t});\n\t}\n\n  handleLoadChat = evt => {\n    evt.preventDefault();\n\n    this.setState({\n      chatID: parseInt(evt.currentTarget.id.split(', ')[1]),\n      otherID: parseInt(evt.currentTarget.id.split(', ')[0]),\n      chatHistory: [],\n    });\n\n    let myID = parseInt(localStorage.id);\n    let chatID = parseInt(evt.currentTarget.id.split(', ')[1]);\n    let otherID = parseInt(evt.currentTarget.id.split(', ')[0]);\n    this.props.loadChat(myID, chatID, otherID);\n  }\n\n\thandleChatInput = evt => this.setState({\n\t\tchatInput: evt.target.value\n\t});\n\n  render() {\n    return (\n      <div id=\"main\">\n        <Header />\n\n        <div className=\"Messages-container\">\n\t\t\t<div className=\"Messages-container-left\">\n\t\t\t\t<div id=\"Messages-search-input\">\n\t\t\t\t\t<form id=\"messages-search\" onSubmit={this.handleSearch}>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tvalue={ this.state.searchValue }\n\t\t\t\t\t\t\tplaceholder=\"Search\"\n\t\t\t\t\t\t\tid=\"message-search-form\"\n\t\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\t\tonChange={ evt => this.setState({searchValue: evt.target.value}) }\n\t\t\t\t\t\t/>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\n\t\t\t\t{ this.props.allMessages ? \n\t\t\t\t\tthis.props.allMessages.map((messages, i) => (\n\t\t\t\t\t\t<div key={i} className={ this.state.chatID === messages.chat_id ? \"Selected-Chats\" : \"Chats\"} id={`${messages.id}, ${messages.chat_id}`}>\n\t\t\t\t\t\t\t<div className={ this.state.chatID === messages.chat_id ? \"colorOverlay\" : null}>\n\t\t\t\t\t\t\t\t<Chats data={ messages }/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)) : ( <div className=\"Loading-Chats\">loading chat history</div> )\n\t\t\t\t}\n\t\t\t</div>\n\n            <div className=\"Chatbox-header\">\n\t\t\t\t{ this.props.allMessages.length ? this.props.allMessages.map((messages, i) => this.state.chatID === messages.chat_id ? (\n\t\t\t\t\t\t<div id=\"chat-header\" key={i}>\n\t\t\t\t\t\t\t<div className=\"Chat-image\">\n\t\t\t\t\t\t\t\t<a href={`/users/${messages.chat_users[messages.chat_users[1].id === this.state.ID ? 0 : 1].id}`} >\n\t\t\t\t\t\t\t\t<img src={messages.avatar_thumb} alt=\"chat\" />\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div id=\"Chat-Name\">\n\t\t\t\t\t\t\t\t<a href={`/users/${messages.chat_users[messages.chat_users[1].id === this.state.ID ? 0 : 1].id}`} >\n\t\t\t\t\t\t\t\t{messages.name}\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : null )\n\t\t\t\t\t: <div className=\"No-Messages\"></div>\n\t\t\t\t}\n            </div>\n\n          <div className=\"Messages-container-right\">\n            { this.props.messages.length ? (\n              <ChatBox\n                canon={this.props.messages[0].chat_id}\n                chatID={this.state.chatID}\n              />\n            ) : ( <div className=\"No-Messages\"> No messages yet </div> )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n\nDirectMessage.defaultProps = {\n\tusername: localStorage.name\n};\n\nconst mapStateToProps = state => ({\n    user : state.userList,\n    chatID : state.chatID,\n    messages : state.chatList,\n    allMessages : state.allChatsList\n});\n\nexport default connect(mapStateToProps, {getUser, sendNewMessage, loadChat, createChatID, getAllChats})(DirectMessage);"]},"metadata":{},"sourceType":"module"}